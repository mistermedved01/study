# Disaster Recovery

**Disaster Recovery** — катастрофоустойчивость или аварийное восстановление, инструмент реагирования на критические сбои в IT-инфраструктуре компании, направленный на быстрое восстановление работы всех систем. То есть отказ серверной или даже всего ЦОДа не должен надолго (в отдельных случаях речь о секундах) прерывать бизнес-процессы.

Реализация DR основана на управлении рисками (анализ, оценка, нужен ли вообще план восстановления, планирование). Один из вариантов — дублирующая инфраструктура, способная взять на себя всю нагрузку, если основная система откажет. В идеале ключевые узлы инфраструктуры должны работать по принципу **георезервирования**:

- **Георезерв инфраструктуры** — запасную инфраструктуру разворачивают в другой геолокации, не подверженной или менее подверженной аналогичным природным или техногенным ЧС. Инфраструктура дублируется в разных городах;

- **Георезерв интернет каналов** — другие магистральные интернет-провайдеры, каналы которых не проходят в одном месте. Если экскаватор пробьет один из каналов, когда будет копать рядом с ЦОДом, это не остановит работу.

- **Георезерв электросети** — зачастую используют другие магистральные каналы. Например, выходит из строя местная электростанция, основной ЦОД переходит на дизельные генераторы, а запасной ЦОД продолжит питаться от ГЭС. Так как второй вариант дешевле, можно остановить работу первого ЦОДа, пока аварийные службы восстанавливают электропитание. Такой подход также используют и в рамках одного ЦОДа;

**Disaster Recovery Plan** — документ с детальным описанием всех действий по устранению последствий аварии и восстановлению данных. В нём указаны роли и обязанности ответственных сотрудников, последовательность предпринимаемых ими действий.

**Как составляется Disaster Recovery Plan?**

**Disaster Recovery Plan** начинается с **подсчёта рисков** — финансового и репутационного ущерба. **При этом затраты на реализацию плана не должны превышать возможных потерь из-за простоя системы.**

**Разберем каждый ущерб отдельно:**

1. **Финансовый ущерб** подсчитывают заранее в денежном эквиваленте: рассчитывают стоимость простоя (час, сутки) по каждому бизнес-процессу.

    Организация недополучает 100 000 рублей выручки за каждый час упавших серверов.

2. **Репутационный ущерб** может оказаться губительнее в перспективе, чем финансовый. Его сложно посчитать в рублях.

    Для поставщиков IT-услуг простой серверов может означать огромный отток текущих клиентов и недополучение новых заявок.
____
# Аварийное восстановление

## Типы аварийного восстановления:

![Название скриншота 0](https://github.com/mistermedved01/study/blob/master/%D0%9E%D1%82%D0%BA%D0%B0%D0%B7%D0%BE%D1%83%D1%81%D1%82%D0%BE%D0%B9%D1%87%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%8C_(Fault%20Tolerance)/01-Disaster_Recovery_FHRP_Keepalived/img/dr_type.jpg)

**1. Резевное копирование** — самый простой тип аварийного восстановления, который подразумевает хранение данных в другом расположении или на удалённом накопителе.

Резервное копирование обеспечивает минимальную защиту непрерывности бизнеса, потому что нельзя сделать резервную копию IT-инфраструктуры, восстановление данных из резервных копий занимает достаточно много времени.

**Использование:** хранение данных в другом расположении или на удалённом накопителе.

| Плюсы | Минусы | 
|:----------------|:---------|
| Простой тип аварийного восстановления | Нельзя сделать резервную копию IT-инфраструктуры | 
|| Восстановление данных из резервных копий занимает много времени | 

_Пример:_ Veeam Backup & Replication, Veritas NetBackup, Acronis Backup, Commvault, Backup Exec.

**2. Горячая резервная площадка** — постоянная поддержка наличия актуальных копий данных.

Этот метод более трудоемкий и дорогой, чем предыдущий, но значительно сокращает время простоев.

**Использование:** резервные элементы находятся во включённом состоянии, активно работают и разделяют нагрузку между собой.

| Плюсы | Минусы | 
|:----------------|:---------|
| Мгновенно готова к работе | Дорогой и трудоёмкий способ | 
| Высокая доступность | Возникают ограничения в выборе аппаратного и программного обеспечения | 
| Обычно используется в качестве кратковременного решения, но иногда её используют длительно ||

_Пример:_ **VMware Site Recovery Manager (SRM):** Решение от VMware, предназначенное для автоматизации процессов аварийного восстановления и репликации данных между различными ЦОД. Оно позволяет быстро активировать горячую резервную площадку и восстановить бизнес-процессы в случае кризиса.

**3. Холодная резервная площадка** — этот тип аварийного восстановления подразумевает, что организация устанавливает базовую инфраструктуру на другом, редко используемом объекте, где сотрудники смогут работать после стихийного бедствия.

Это способствует поддержанию непрерывности бизнеса, поскольку работа продолжается. Такой подход не обеспечивает защиту или восстановление важных данных, поэтому его нужно совмещать с другими типами аварийного восстановления.

**Использование:** резервные узлы выключены и даже могут находиться на складе

| Плюсы | Минусы | 
|:----------------|:---------|
| Менее дорогое решение | Доступна только через некоторое время — нет возможности быстро начать работу | 
| Доступна на более длительное время за меньшие деньги | Обычно её нельзя периодически тестировать | 
| Удобно применять, если используется специализированное или дорогостоящее программное обеспечение и оборудование | Не обеспечивает защиту или восстановление важных данных, поэтому её необходимо совмещать с другими типами аварийного восстановления |

**4. Аварийное восстановление ЦОД (центра обработки данных)** — постоянная поддержка наличия актуальных копий данных.

Физические элементы ЦОД могут обеспечить защиту данных и способствовать ускоренному аварийному восстановлению при некоторых типах аварий.

**Использование:** надёжность и безопасность ЦОД увеличивается с каждым уровнем по классификации Tier.

- **Tier I** - Базовая инфраструктура начального уровня. ЦОД, соответствующий первому уровню, должен иметь выделенное под ИТ-оборудование пространство, ИБП, охлаждающие системы и генератор для минимизации простоев при проблемах с питанием. 
Такие объекты не имеют запасных ресурсов, а критически важные элементы инфраструктуры не зарезервированы. Поломка любой из систем для ЦОД уровня Tier I нарушает (или даже останавливает) работу всего объекта.

- **Tier II** - Присутствует резервирование критически важных компонентов. Работа такого ЦОД может быть нарушена аварийной ситуацией или проведением плановых работ — при профилактике он будет отключен. Активное оборудование резервируется по схеме N+1, присутствует один энерговвод.

- **Tier III** - Ключевое отличие — возможность ремонта и модернизации без отключения оборудования и остановки работы дата-центра. Иными словами, клиенты такого дата-центра даже не узнают, что на объекте проводилась профилактика или замена вышедших из строя компонентов. Tier III ЦОД имеет уже два энерговвода, активное оборудование резервируется по схеме N+1, а вот потоки — по 2N.
Подавляющее число коммерческих ЦОД в России соответствуют требованиям Tier 3.

- **Tier IV** - Самый высокий уровень на сегодняшний день. Фактически ЦОД уровня Tier IV представляет собой дата-центр третьего уровня с добавлением концепции отказоустойчивости в топологическую схему. Объект, которому присвоен наивысший уровень в классификации Uptime Institute, будет работать даже при системном сбое или проведении ремонтных работ.
Максимальный показатель доступности — 99.995% — достигается благодаря дублированному резервированию инженерных систем (2(N+1)). Это означает, что дублируются и основные, и дополнительные системы ЦОД. Более того, для большей отказоустойчивости основные и резервные компоненты разнесены по разным помещениям. Допустимое время простоя ЦОД Tier IV составляет всего лишь 26 минут в год.

|| Tier I | Tier II | Tier III | Tier IV |
|:----------------|:----------------|:---------|:----------------|:----------------|
| Резервирование оборудования | нет | N+1 | N+1 | 2(N+1)|
| Возможность обслуживания без остановки | нет | нет | да | да |
| Годовой простой | 28.8 часов | 22 часа | 1.6 часа | 26 минут |
| Уровень доступности | 99.671% | 99.749% | 99,982% | 99.995% |

**5. Аварийное восстановление как услуга** — (disaster recovery as a service) — облачный сервис быстрого аварийного восстановления работы виртуальных серверов в резервном центре обработки данных

В случае аварии или кибератаки поставщик услуги DRaaS перемещает вычислительные процессы организации в собственную облачную инфраструктуру. Это позволяет компании продолжать работу из расположения поставщика, даже если её серверы отключены.

| Плюсы | Минусы | 
|:----------------|:---------|
| Не нужно обслуживать резервную систему и нанимать персонал | Недоверие к поставщику облачных услуг | 
| Интегрируются с большинством популярных платформ и могут работать с разным оборудованием и приложениями | Зависимость от его услуг | 
| Всегда дешевле собственного резервного ЦОД ||

_Примеры_: VMware Cloud Director Availability, Veeam Cloud Connect Replication

## Критерии оценки эффективности аварийного восстановления

Важные параметры аварийного восстановления:

- **RPO (recovery point objective)** - максимальный период, за который могут быть потеряны данные в результате инцидента. **То как часто необходимо делать снимки состояния.**

- **RTO (recovery time objective)** - промежуток времени, в течение которого система может оставаться недоступной в случае аварии. **За какое время система должна восстановиться.**

![Название скриншота 1](https://github.com/mistermedved01/study/blob/master/%D0%9E%D1%82%D0%BA%D0%B0%D0%B7%D0%BE%D1%83%D1%81%D1%82%D0%BE%D0%B9%D1%87%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%8C_(Fault%20Tolerance)/01-Disaster_Recovery_FHRP_Keepalived/img/rpo_rto.jpg)

**Время восстановления файлов из резервного хранилища не должно превышать показатель RPO.**

Если RPO равен 90 минутам, будут потеряны данные, наработанные не более чем за последние полтора часа. Значит Snapshot (снимок) должен проводиться не реже чем раз в 90 минут.

Резервировать можно не только файлы на дисках, но и настройки приложений, серверных ОС, а также состояние процессов в оперативной памяти.

RTO может составлять от нескольких секунд (при репликации в облаке) до нескольких дней, когда бэкап пишется на физические носители (на магнитную ленту)

**Значения RTO и RPO каждая организация устанавливает индивидуально** исходя из специфики и задач бизнеса:

- Если это клиентский портал банка, время простоя не должно превышать несколько минут
- Персональный сайт может быть недоступен сутки и более

**Уровни настройки RPO для бизнес подразделений**

- До 1 часа. Критически важные операции, в которых нельзя потерять данные более, чем за час. Бизнес транзакции и транзакции с данными обычно имеют больший объём и более динамичны, что делает их воссоздание часто невозможным из за большого количества задействованных переменных.
  
  Примеры: банковские транзакции, система CRM и записи пациентов.

- От 1 до 4 часов. Бизнес подразделения, которые могут допустить потерю данных на срок до четырёх часов, по своей природе являются полукритическими.

  Примеры: журналы чатов клиентов и файловые серверы.

- От 4 до 12 часов. Бизнес подразделения, попадающие в эту категорию, не могут допустить потери информации более чем за 12 часов.

  Пример: данные о маркетинге и продажах.

- От 13 до 24 часов. Бизнес подразделения, входящие в эту категорию, обрабатывают полуважные данные, и им требуется RPO за последние 24 часа.

  Примеры: отделы кадров и закупок, которые обновляют данные реже, чем исходящие секторы бизнеса.

**Время восстановления файлов из резервного хранилища не должно превышать показатель RPO.**

![Название скриншота 2](https://github.com/mistermedved01/study/blob/master/%D0%9E%D1%82%D0%BA%D0%B0%D0%B7%D0%BE%D1%83%D1%81%D1%82%D0%BE%D0%B9%D1%87%D0%B8%D0%B2%D0%BE%D1%81%D1%82%D1%8C_(Fault%20Tolerance)/01-Disaster_Recovery_FHRP_Keepalived/img/rpo.jpg)

**Итоги**

- Основные типы восстановления IT-инфраструктуры: резервное копирование, резервные площадки, аварийное восстановление как услуга (DRaaS)
- Ключевые показатели эффективности аварийного восстановления RPO и RTO. RPO это то, как часто необходимо делать снимки состояния, а RTO говорит о том, за какое время система должна восстановиться
- Аварийное восстановление необходимо компаниям, где репутационные и финансовые риски превышают возможную стоимость решения по аварийному восстановлению
